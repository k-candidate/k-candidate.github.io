---
layout: post
title: "E2E Tests - Automating Book Availability Checks"
date: 2026-03-08 00:00:00-0000
categories: 
---

In the previous post I covered what E2E (end-to-end) tests are.

In this post I do the implementation via this PR: [https://github.com/k-candidate/selenium-book-search-slack-alerts/pull/40](https://github.com/k-candidate/selenium-book-search-slack-alerts/pull/40).

What I am basically doing here is running the actual code for real, except for the Slack part.  
By that I mean that I am using the actual browser. It's a tradeoff: speed (seconds) for confidence.

## Why not the Slack part?  

Because:
- it is very unlikely to change.
- the actual code runs every day. So if something changes from Slack's side, I'd know because I won't receive a notification in my Slack.

## So what does the e2e test do here?  

It checks for 2 books:
- one that exists (in this case 1984), and asserts that it is "available".
- one that does not exist (a random string of characters: dfvtvrbg) and asserts that it is "not_found".

This covers all the scenarios, including when something changes from the webserver's side because the 2 book queries will fail and I will know that I have to adapt the code.

This e2e test will run in every PR.

![PR tests]({{ site.baseurl }}/assets/images/e2e-01.png){:style="display:block; margin-left:auto; margin-right:auto; width:100.00%"}

## How to run the e2e test locally?

```bash
# source .venv/bin/activate
export WEBSITE_URL=https://www.theactualwebsite.com/
export SLACK_WEBHOOK_URL=https://hooks.slack.com/services/blablabla
pytest tests/e2e/ --no-cov -v -s
```

## What new things have I learned?

Capturing output in pytest. See the `-s` in the command (above for the local run, and [in the gha workflow file](https://github.com/k-candidate/selenium-book-search-slack-alerts/pull/40/changes#diff-2154d5cafbed57574ae09e3c4689fb9aa37e3472f599d6a27c00e5564149f4e6R40)), and [the print() in the test file](https://github.com/k-candidate/selenium-book-search-slack-alerts/pull/40/changes#diff-fb5508667c1c206bea852a140d8ae6a630d50e2260bc834df46a54bb297acd45R27).

For more information, see [https://docs.pytest.org/en/stable/how-to/capture-stdout-stderr.html](https://docs.pytest.org/en/stable/how-to/capture-stdout-stderr.html).

![e2e pytest output]({{ site.baseurl }}/assets/images/e2e-02.png){:style="display:block; margin-left:auto; margin-right:auto; width:100.00%"}

## Final thoughts

With this, I think I am comfortable merging PRs if I see the tests pass. I mean I could consider auto-merging renovate bot's PRs if all tests pass. But I won't do that for now. I want to do some reading about it first.
